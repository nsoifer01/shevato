<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Config Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 {
            color: #4CAF50;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .success {
            background: #4CAF50;
            color: white;
        }
        .error {
            background: #f44336;
            color: white;
        }
        .warning {
            background: #ff9800;
            color: white;
        }
        .info {
            background: #2196F3;
            color: white;
        }
        pre {
            background: #1a1a1a;
            padding: 15px;
            overflow-x: auto;
            border: 1px solid #444;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .instructions {
            background: #333;
            padding: 15px;
            border-left: 4px solid #4CAF50;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸ”§ Firebase Configuration Test</h1>
    
    <div class="instructions">
        <h2>Instructions:</h2>
        <ol>
            <li>Push this file to your repository</li>
            <li>Access it at: https://www.shevato.com/test-firebase-config.html</li>
            <li>Click the test buttons below to diagnose the issue</li>
            <li>Screenshot the results and share if you need help</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>Test 1: Environment Variables Check</h2>
        <button onclick="testEnvVars()">Test Environment Variables</button>
        <div id="env-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Firebase Config Function</h2>
        <button onclick="testFirebaseConfig()">Test Firebase Config</button>
        <div id="config-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Window Firebase Config</h2>
        <button onclick="testWindowConfig()">Check Window Config</button>
        <div id="window-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Complete Flow Test</h2>
        <button onclick="runCompleteTest()">Run Complete Test</button>
        <div id="complete-result"></div>
    </div>

    <script>
        async function testEnvVars() {
            const resultDiv = document.getElementById('env-result');
            resultDiv.innerHTML = '<span class="status info">Testing...</span>';
            
            try {
                const response = await fetch('/.netlify/functions/test-env');
                const data = await response.json();
                
                let html = '<h3>Environment Variables Test:</h3>';
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                if (data.firebaseVarsFound > 0) {
                    html += '<span class="status success">âœ“ Found ' + data.firebaseVarsFound + ' Firebase variables</span>';
                } else {
                    html += '<span class="status error">âœ— No Firebase variables found!</span>';
                    html += '<div class="instructions">';
                    html += '<strong>Fix Required:</strong><br>';
                    html += '1. Go to Netlify Dashboard â†’ Environment Variables<br>';
                    html += '2. Make sure each Firebase variable has "Functions" scope enabled<br>';
                    html += '3. Redeploy your site after making changes';
                    html += '</div>';
                }
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<span class="status error">Error: ' + error.message + '</span>';
            }
        }

        async function testFirebaseConfig() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.innerHTML = '<span class="status info">Testing...</span>';
            
            try {
                const response = await fetch('/.netlify/functions/firebase-config');
                const text = await response.text();
                
                let html = '<h3>Firebase Config Response:</h3>';
                html += '<pre>' + text + '</pre>';
                
                // Try to parse the config
                eval(text);
                
                if (window.firebaseConfig && window.firebaseConfig.apiKey) {
                    html += '<span class="status success">âœ“ Config loaded with API key</span>';
                } else {
                    html += '<span class="status error">âœ— Config loaded but API key is empty</span>';
                }
                
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = '<span class="status error">Error: ' + error.message + '</span>';
            }
        }

        function testWindowConfig() {
            const resultDiv = document.getElementById('window-result');
            
            let html = '<h3>Current Window Config:</h3>';
            
            if (typeof window.firebaseConfig !== 'undefined') {
                html += '<pre>' + JSON.stringify(window.firebaseConfig, null, 2) + '</pre>';
                
                const hasApiKey = window.firebaseConfig.apiKey && window.firebaseConfig.apiKey.length > 0;
                const hasAuthDomain = window.firebaseConfig.authDomain && window.firebaseConfig.authDomain.length > 0;
                const hasProjectId = window.firebaseConfig.projectId && window.firebaseConfig.projectId.length > 0;
                
                if (hasApiKey && hasAuthDomain && hasProjectId) {
                    html += '<span class="status success">âœ“ Config is complete</span>';
                } else {
                    html += '<span class="status warning">âš  Config is incomplete</span>';
                    if (!hasApiKey) html += '<br><span class="status error">Missing: API Key</span>';
                    if (!hasAuthDomain) html += '<br><span class="status error">Missing: Auth Domain</span>';
                    if (!hasProjectId) html += '<br><span class="status error">Missing: Project ID</span>';
                }
            } else {
                html += '<span class="status error">âœ— window.firebaseConfig is not defined</span>';
            }
            
            resultDiv.innerHTML = html;
        }

        async function runCompleteTest() {
            const resultDiv = document.getElementById('complete-result');
            resultDiv.innerHTML = '<span class="status info">Running complete test...</span>';
            
            let results = [];
            
            // Test 1: Check environment
            const isProduction = !window.location.hostname.includes('localhost');
            results.push({
                test: 'Environment',
                status: isProduction ? 'Production' : 'Local',
                passed: true
            });
            
            // Test 2: Test env function
            try {
                const envResponse = await fetch('/.netlify/functions/test-env');
                const envData = await envResponse.json();
                results.push({
                    test: 'Environment Variables',
                    status: envData.firebaseVarsFound > 0 ? `Found ${envData.firebaseVarsFound} vars` : 'No vars found',
                    passed: envData.firebaseVarsFound > 0
                });
            } catch (e) {
                results.push({
                    test: 'Environment Variables',
                    status: 'Function not accessible',
                    passed: false
                });
            }
            
            // Test 3: Test config function
            try {
                const configResponse = await fetch('/.netlify/functions/firebase-config');
                const configText = await configResponse.text();
                eval(configText);
                const hasConfig = window.firebaseConfig && window.firebaseConfig.apiKey;
                results.push({
                    test: 'Firebase Config Function',
                    status: hasConfig ? 'Config loaded' : 'Empty config',
                    passed: hasConfig
                });
            } catch (e) {
                results.push({
                    test: 'Firebase Config Function',
                    status: 'Error loading',
                    passed: false
                });
            }
            
            // Generate report
            let html = '<h3>Complete Test Results:</h3>';
            html += '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th style="text-align: left; padding: 10px; border-bottom: 1px solid #444;">Test</th>';
            html += '<th style="text-align: left; padding: 10px; border-bottom: 1px solid #444;">Status</th>';
            html += '<th style="text-align: left; padding: 10px; border-bottom: 1px solid #444;">Result</th></tr>';
            
            for (const result of results) {
                html += '<tr>';
                html += '<td style="padding: 10px;">' + result.test + '</td>';
                html += '<td style="padding: 10px;">' + result.status + '</td>';
                html += '<td style="padding: 10px;">';
                html += result.passed ? 
                    '<span class="status success">âœ“ Passed</span>' : 
                    '<span class="status error">âœ— Failed</span>';
                html += '</td>';
                html += '</tr>';
            }
            
            html += '</table>';
            
            const allPassed = results.every(r => r.passed);
            if (allPassed) {
                html += '<br><span class="status success">âœ“ All tests passed! Firebase auth should work.</span>';
            } else {
                html += '<br><span class="status error">âœ— Some tests failed. See above for details.</span>';
            }
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>